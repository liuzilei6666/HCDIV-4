<!DOCTYPE html>  
<html>  
<head>  
  <meta charset="UTF-8">  
  <script src="https://cdn.tailwindcss.com"></script>  
  <style>  
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');  
    
    body {  
      font-family: 'Poppins', sans-serif;  
      background: linear-gradient(135deg, #2d1810, #3c1f1a, #2d1810);  
      margin: 0;  
      min-height: 100vh;  
    }  
    
    .map-container {  
      position: relative;  
      background: rgba(255, 235, 225, 0.03);  
      border-radius: 20px;  
      backdrop-filter: blur(10px);  
      padding: 20px;  
      margin: 20px;  
      border: 1px solid rgba(255, 160, 122, 0.2);  
    }  
    
    .map-title {  
      font-family: 'Poppins', sans-serif;  
      background: linear-gradient(45deg, #ff6b4a, #ffa07a);  
      -webkit-background-clip: text;  
      background-clip: text;  
      color: transparent;  
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);  
    }  
    
    #tooltip {  
      position: absolute;  
      background: rgba(45, 24, 16, 0.95);  
      color: #fff;  
      border-radius: 12px;  
      padding: 15px;  
      font-size: 14px;  
      pointer-events: none;  
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);  
      border: 1px solid rgba(255, 160, 122, 0.2);  
      z-index: 20;  
      display: none;  
    }  
    
    .control-button {  
      background: linear-gradient(45deg, #ff6b4a, #ffa07a);  
      transition: all 0.3s ease;  
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);  
    }  
    
    .control-button:hover {  
      transform: translateY(-2px);  
      box-shadow: 0 5px 15px rgba(255, 107, 74, 0.3);  
    }  
    
    #legend {  
      background: rgba(45, 24, 16, 0.9);  
      border-radius: 15px;  
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);  
      border: 1px solid rgba(255, 160, 122, 0.2);  
      color: #ffdcd1;  
    }  
    
    path.highlight {  
      stroke: #ff6b4a !important;  
      stroke-width: 3 !important;  
      filter: drop-shadow(0 0 8px rgba(255, 107, 74, 0.6));  
    }  
    
    path {  
      transition: all 0.3s ease;  
    }  

    .search-container {  
      background: rgba(45, 24, 16, 0.9);  
      border-radius: 15px;  
      padding: 10px;  
      border: 1px solid rgba(255, 160, 122, 0.2);  
    }  

    .search-input {  
      background: rgba(255, 255, 255, 0.05);  
      border: 1px solid rgba(255, 160, 122, 0.2);  
      color: #ffdcd1;  
    }  

    .search-input::placeholder {  
      color: rgba(255, 220, 209, 0.5);  
    }  

    .search-input:focus {  
      outline: none;  
      border-color: #ff6b4a;  
      box-shadow: 0 0 0 2px rgba(255, 107, 74, 0.2);  
    }  
  </style>  
</head>  
<body class="p-4">  
  <h1 class="map-title text-5xl text-center mb-8 mt-4 font-bold">Singapore District Atlas</h1>  
  
  <div class="search-container fixed top-6 left-6 flex gap-3 z-10 p-3">  
    <input id="search-input"   
           type="text"   
           placeholder="Find your district..."   
           class="search-input w-72 px-4 py-2 rounded-xl transition-all duration-300"  
    />  
    <button id="search-button"   
            class="control-button px-6 py-2 text-white font-semibold rounded-xl">  
      Search  
    </button>  
  </div>  
  
  <button class="control-button fixed bottom-6 left-6 px-8 py-3 text-white font-semibold rounded-xl">  
    Reset View  
  </button>  
  
  <div class="map-container">  
    <svg class="mx-auto"></svg>  
  </div>  
  
  <div id="tooltip"></div>  
  
  <div id="legend" class="fixed bottom-6 right-6 p-5">  
    <strong class="text-sm block mb-3">POPULATION DENSITY</strong>  
    <svg width="180" height="20" class="mt-2 mb-2"></svg>  
    <div class="flex justify-between text-xs text-gray-300">  
      <span id="legend-min">0</span>  
      <span id="legend-max">0</span>  
    </div>  
  </div>  

  <script src="https://d3js.org/d3.v7.min.js"></script>  
  <script>  
    let width = 1000, height = 600;  

    let svg = d3.select("svg")  
        .attr("viewBox", "0 0 " + width + " " + height);  

    Promise.all([d3.json("sgmap.json"), d3.csv("population2023.csv")]).then(data => {  
        let mapData = data[0].features;  
        let popData = data[1];  

        mapData.forEach(d => {  
            let subzone = popData.find(e => e.Subzone.toUpperCase() === d.properties.Name.toUpperCase());  
            d.popdata = (subzone != undefined) ? parseInt(subzone.Population) : 0;  
        });  

        let projection = d3.geoMercator()  
            .center([103.851959, 1.290270])  
            .fitExtent([[20, 20], [980, 580]], data[0]);  

        let geopath = d3.geoPath().projection(projection);  

        // 使用暖色调配色方案  
        let customColors = d3.scaleSequential()  
            .domain([0, d3.max(mapData, d => d.popdata)])  
            .interpolator(d3.interpolate("#ffe5d9", "#ff6b4a"));  

        let tooltip = d3.select("#tooltip");  
        let g = svg.append("g").attr("id", "districts");  

        g.selectAll("path")  
            .data(mapData)  
            .enter()  
            .append("path")  
            .attr("d", geopath)  
            .attr("stroke", "rgba(255, 160, 122, 0.3)")  
            .attr("stroke-width", 1)  
            .attr("fill", d => customColors(d.popdata))  
            .on("mouseover", (event, d) => {  
                d3.select(event.target)  
                  .attr("stroke-width", 2)  
                  .attr("stroke", "#ff6b4a");  
                
                tooltip.style("display", "block")  
                       .html(`  
                         <div class="font-semibold mb-2 text-[#ffa07a]">${d.properties.Name}</div>  
                         <div class="text-[#ffdcd1]">Population: ${d.popdata.toLocaleString()}</div>  
                       `);  
            })  
            .on("mousemove", event => {  
                tooltip.style("left", (event.pageX + 15) + "px")  
                       .style("top", (event.pageY - 25) + "px");  
            })  
            .on("mouseout", event => {  
                d3.select(event.target)  
                  .attr("stroke-width", 1)  
                  .attr("stroke", "rgba(255, 160, 122, 0.3)");  
                tooltip.style("display", "none");  
            })  
            .on("click", (event, d) => {  
                d3.selectAll("path").classed("highlight", false);  
                d3.select(event.target).classed("highlight", true);  
            });  

        let zoom = d3.zoom()  
            .scaleExtent([1, 8])  
            .on("zoom", (event) => {  
                g.attr("transform", event.transform);  
            });  

        svg.call(zoom);  

        d3.select(".control-button").on("click", () => {  
            d3.selectAll("path").classed("highlight", false);  
            svg.transition()  
                .duration(1000)  
                .call(zoom.transform, d3.zoomIdentity);  
        });  

        d3.select("#search-button").on("click", () => {  
            let query = document.getElementById("search-input").value.trim().toUpperCase();  
            let match = mapData.find(d => d.properties.Name.toUpperCase() === query);  

            if (match) {  
                d3.selectAll("path").classed("highlight", false);  
                g.selectAll("path").filter(d => d === match).classed("highlight", true);  

                let [[x0, y0], [x1, y1]] = geopath.bounds(match);  

                svg.transition()  
                    .duration(1000)  
                    .call(  
                        zoom.transform,  
                        d3.zoomIdentity  
                            .translate(width / 2, height / 2)  
                            .scale(Math.min(8, 0.9 / Math.max((x1 - x0) / width, (y1 - y0) / height)))  
                            .translate(-(x0 + x1) / 2, -(y0 + y1) / 2)  
                    );  
            } else {  
                alert("No matching district found. Please try again.");  
            }  
        });  

        // 更新图例为新的配色方案  
        let legendSvg = d3.select("#legend svg");  
        let gradient = legendSvg.append("defs")  
            .append("linearGradient")  
            .attr("id", "gradient")  
            .attr("x1", "0%")  
            .attr("x2", "100%")  
            .attr("y1", "0%")  
            .attr("y2", "0%");  

        gradient.append("stop")  
            .attr("offset", "0%")  
            .attr("stop-color", "#ffe5d9");  

        gradient.append("stop")  
            .attr("offset", "100%")  
            .attr("stop-color", "#ff6b4a");  

        legendSvg.append("rect")  
            .attr("x", 0)  
            .attr("y", 0)  
            .attr("width", 180)  
            .attr("height", 20)  
            .attr("rx", 5)  
            .style("fill", "url(#gradient)");  

        d3.select("#legend-min").text("0");  
        d3.select("#legend-max").text(d3.max(mapData, d => d.popdata).toLocaleString());  
    });  
  </script>  
</body>  
</html>  
